YUI.add("hermes-template-explore-page",function(t,a){var e=t.Template.Handlebars.revive({1:function(t,a,e,l,n){return'<button class="tool tools-menu"></button>'},3:function(t,a,e,l,n){return" selected"},5:function(t,a,e,l,n){return" is-disabled"},compiler:[7,">= 4.0.0"],main:function(t,a,e,l,n){var r,o,u=null!=a?a:{},s=e.helperMissing,i=t.escapeExpression,c="function";return i((e.outlet||a&&a.outlet||s).call(u,null!=a?a["global-nav-view"]:a,{name:"outlet",hash:{},data:n}))+"\n\n"+i((e.outlet||a&&a.outlet||s).call(u,null!=a?a["fluid-explore-subnav-view"]:a,{name:"outlet",hash:{},data:n}))+'\n\n<div role="main" class="main fluid-centered">\n\n\t<div class="title-row">\n\n\t\t<h3>'+i((e.intlMessage||a&&a.intlMessage||s).call(u,{name:"intlMessage",hash:{intlName:"common.EXPLORE"},data:n}))+'</h3>\n\n\t\t<div class="tools">\n\t\t\t'+(null!=(r=e.if.call(u,null!=a?a.godUser:a,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n}))?r:"")+'\n\t\t\t<button data-layout-style="justified" class="tool layout justified'+(null!=(r=e.if.call(u,null!=a?a.isJustifiedLayout:a,{name:"if",hash:{},fn:t.program(3,n,0),inverse:t.noop,data:n}))?r:"")+'" data-track="explore-layout-justified"></button>\n\t\t\t<button data-layout-style="story" class="tool layout story'+(null!=(r=e.if.call(u,null!=a?a.isStoryLayout:a,{name:"if",hash:{},fn:t.program(3,n,0),inverse:t.noop,data:n}))?r:"")+'" data-track="explore-layout-story"></button>\n\t\t</div>\n\n\t</div>\n\n\t'+i((e.outlet||a&&a.outlet||s).call(u,null!=a?a["photo-list-view"]:a,{name:"outlet",hash:{},data:n}))+'\n\n\t<div class="explore-pagination">\n\t\t<a href="'+i(typeof(o=null!=(o=e.prevDateLink||(null!=a?a.prevDateLink:a))?o:s)===c?o.call(u,{name:"prevDateLink",hash:{},data:n}):o)+'" class="butt page-back" data-track="explore-page-back">'+i(typeof(o=null!=(o=e.prevDateStr||(null!=a?a.prevDateStr:a))?o:s)===c?o.call(u,{name:"prevDateStr",hash:{},data:n}):o)+'</a>\n\t\t<a class="butt curr-date">'+i(typeof(o=null!=(o=e.currDateStr||(null!=a?a.currDateStr:a))?o:s)===c?o.call(u,{name:"currDateStr",hash:{},data:n}):o)+'</a>\n\t\t<a href="'+i(typeof(o=null!=(o=e.nextDateLink||(null!=a?a.nextDateLink:a))?o:s)===c?o.call(u,{name:"nextDateLink",hash:{},data:n}):o)+'" class="butt page-forward'+(null!=(r=e.if.call(u,null!=a?a.disableNext:a,{name:"if",hash:{},fn:t.program(5,n,0),inverse:t.noop,data:n}))?r:"")+'" data-track="explore-page-forward">'+i(typeof(o=null!=(o=e.nextDateStr||(null!=a?a.nextDateStr:a))?o:s)===c?o.call(u,{name:"nextDateStr",hash:{},data:n}):o)+"</a>\n\t</div>\n\n</div>\n\n"+i((e.outlet||a&&a.outlet||s).call(u,null!=a?a["signup-footer-view"]:a,{name:"outlet",hash:{},data:n}))+"\n\n"+i((e.outlet||a&&a.outlet||s).call(u,null!=a?a["footer-full-view"]:a,{name:"outlet",hash:{},data:n}))+"\n"},useData:!0}),l={};t.Array.each([],function(a){var e=t.Template.get("hermes/"+a);e&&(l[a]=e)}),t.Template.register("hermes/explore-page",function(a,n){return n=n||{},n.partials=n.partials?t.merge(l,n.partials):l,e(a,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-explore-big-scotch-modal",function(e,a){var s=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,s,l,n){var t,r=null!=a?a:{},o=s.helperMissing,d=e.escapeExpression;return"<p>"+d((s.godMessage||a&&a.godMessage||o).call(r,{name:"godMessage",hash:{intlName:"explore.BIG_SCOTCH_REASON_MESSAGE"},data:n}))+'</p>\n<div class="dropdown-link exclude-reason-menu"><p class="tertiary">'+d("function"==typeof(t=null!=(t=s.selectedExcludeReason||(null!=a?a.selectedExcludeReason:a))?t:o)?t.call(r,{name:"selectedExcludeReason",hash:{},data:n}):t)+'</p><span class="dropdown-arrow"></span></div>\n<input type="text" id="comment-field" name="comment" placeholder="'+d((s.godMessage||a&&a.godMessage||o).call(r,{name:"godMessage",hash:{intlName:"explore.COMMENT"},data:n}))+'" />\n'},useData:!0}),l={};e.Array.each([],function(a){var s=e.Template.get("hermes/"+a);s&&(l[a]=s)}),e.Template.register("hermes/explore-big-scotch-modal",function(a,n){return n=n||{},n.partials=n.partials?e.merge(l,n.partials):l,s(a,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("explore-big-scotch-modal-view",function(e){var t=[];e.config.flickr&&e.config.flickr.god&&e.config.flickr.god.explore&&e.config.flickr.god.explore.scotch&&e.config.flickr.god.explore.scotch.types&&(t=e.config.flickr.god.explore.scotch.types),e.namespace("Views")[this.name]=e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(i){var o,n;for(this.excludeReasons=[],n=0;n<t.length;n++)o=t[n],this.excludeReasons.push(e.merge(o,{text:this.godMessage({intlName:o.intlName})}));return this.set("selectedBigScotchTypeText",this.godMessage({intlName:"explore.PICK_A_REASON"})),this},loadState:function(){return e.Promise.resolve()},buildContainer:function(){return this.setContainerWithTemplate("explore-big-scotch-modal",{selectedExcludeReason:this.get("selectedBigScotchTypeText")}),this},activate:function(){return this.registerEventHandler(this.get("container").one(".exclude-reason-menu").on("click",this.handleExcludeReasonMenuClick.bind(this))),this.registerEventHandler(this.get("container").one("#comment-field").on("valuechange",this.handleCommentValueChange.bind(this))),this},handleExcludeReasonMenuClick:function(t){var i=this;t.halt(),this.dropdown=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,anchorOffsetHorizontal:14,observePageResize:!0,anchorElement:t.target.one(".dropdown-arrow"),positionFixed:!0,preferBottom:!0,classList:"over-modal",overlayClassList:"over-modal",menuItems:this.excludeReasons}),this.dropdown.show(),this.registerEventHandler(this.dropdown.on("selected",function(t){t&&t.menuItem&&t.menuItem.value!==i.get("selectedBigScotchTypeValue")&&(i.set("selectedBigScotchTypeValue",t.menuItem.value),i.set("selectedBigScotchTypeText",t.menuItem.text),i.set("needComment",!!t.menuItem.requiresComment),i.get("container").one(".exclude-reason-menu p").set("text",i.get("selectedBigScotchTypeText")),!t.menuItem.requiresComment||i.get("excludeComment")?e.fire("exploreBigScotch:justificationComplete"):e.fire("exploreBigScotch:justificationIncomplete")),i.dropdown.close()}))},handleCommentValueChange:function(t){var i=this.get("container").one("#comment-field").get("value");this.set("excludeComment",i),this.get("needComment")&&!i?e.fire("exploreBigScotch:justificationIncomplete"):i&&this.get("selectedBigScotchTypeValue")&&e.fire("exploreBigScotch:justificationComplete")}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-droparound-view","hermes-template-explore-big-scotch-modal"],langBundles:[]});YUI.add("fluid-explore-subnav-view",function(e){"use strict";e.FlickrView.create(this.name,e.namespace("Views")["fluid-subnav-view"],[],{langBundles:this.details.langBundles,initializer:function(e){return this.appStateParams=e,this.skipLoadingPersonModel=!0,this.constructor.superclass.initializer.call(this,e)},loadState:function(){return this.populateUrls(),this.constructor.superclass.loadState.call(this)},populateUrls:function(t){var s,i,l=this;s=[{name:this.intlMessage({intlName:"common.EXPLORE"}),id:"explore",href:"/explore"}],this.appContext.flipper.isFlipped("rebootify-tags")&&s.push({name:this.intlMessage({intlName:"common.TRENDING"}),id:"tags",href:"/photos/tags"}),this.appContext.flipper.isFlipped("enable-events-page")&&s.push({label:this.intlMessage({intlName:"common.BETA"}),name:this.intlMessage({intlName:"common.EVENTS"}),id:"events",href:"/events"}),s.push({name:"Your Best Shot 2019",id:"bestshot2019",href:"/groups/yourbestshot2019/"}),i=[{text:this.intlMessage({intlName:"global-nav.THE_COMMONS"}),href:e.url("/commons")},{text:"20under20",href:e.url("/20under20")},{text:this.intlMessage({intlName:"global-nav.GALLERIES"}),href:e.url("/galleries")},{text:this.intlMessage({intlName:"global-nav.WORLD_MAP"}),href:e.url("/map")},{text:this.intlMessage({intlName:"global-nav.APP_GARDEN"}),href:e.url("/services")},{text:this.intlMessage({intlName:"global-nav.CAMERA_FINDER"}),href:e.url("/cameras")}],"en-US"===this.appContext.lang&&i.push({text:this.intlMessage({intlName:"global-nav.THE_WEEKLY_FLICKR"}),href:"/photos/flickr/albums/72157639868074114/"}),i.push({text:this.intlMessage({intlName:"global-nav.FLICKR_BLOG"}),href:"https://blog.flickr.net/"}),this.set("links",s),this.set("moreLinks",i),this.get("selected")&&(this.get("links").filter(function(e){return e.id===l.get("selected")})[0].selected=!0)}})},"@VERSION@",{requires:["flickr-view","fluid-subnav-view","url-helper"],langBundles:["explore","global-nav","common"]});YUI.add("hermes-lang-explore",function(e,l){e.Intl.add("hermes/explore","en-US",{VIDEOS:["Videos"],PLACES:["Places"],DATES:["Dates"]})},"@VERSION@",{requires:["intl"]});YUI.add("explore-page-view",function(e,t){var o=require("hermes-core/flog")(t),i=[];e.config.flickr&&e.config.flickr.god&&e.config.flickr.god.explore&&e.config.flickr.god.explore.scotch&&e.config.flickr.god.explore.scotch.methods&&(i=e.config.flickr.god.explore.scotch.methods),e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.exploreId=t.exploreId,this.photoListLayoutStyle=t.photoListLayoutStyle,this.withPhotoId=t.withPhotoId,this.explorePhotosReadyForMoment=e.moment.utc().subtract({days:1,hours:4}),t.photoListConfig={modelParams:{registryName:"explore-models",modelIdOrAttributes:t.exploreId,collectionAttributeName:"photos"},pageParams:{page:1,perPage:50,perPageDoubling:1},parentName:this.name,measureAFT:!0,loadMoreMargin:3,engagementModelName:"photo-lite-models",contextSuffix:"explore-"+this.exploreId,maintainScrollPosition:!1,scrollToWithId:this.withPhotoId},t.photoListConfig.layout={targetRowHeight:"justified"===this.photoListLayoutStyle?250:430,awakeBoundsToViewportSizeRatio:5,containerPadding:{top:4,right:0,bottom:4,left:0},itemSpacing:{horizontal:4,vertical:4}},t.subnavConfig={selected:"explore"},this.toolsMenuItems=[{text:this.godMessage({intlName:"explore.SCOTCHING_TOOLS"}),callback:this.handleToggleToolsEntry.bind(this)}],this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"fluid-explore-subnav-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"signup-footer-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,pageType:"explore"},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},loadState:function(){var e={},t=this;return this.withPhotoId&&(e.withPhotoId=this.withPhotoId),this.appContext.getModel("explore-models",this.exploreId,e).then(function(e){t.exploreModel=e})},buildHeadContainer:function(){var e="";e+=this.templates("head-meta")({isName:!0,metaName:"viewport",metaValue:"width=device-width, viewport-fit=cover, initial-scale=1, maximum-scale=1"}),this.set("headContainer",e),YUI.Env.isServer||this.updateHead()},buildContainer:function(){var t,o=e.moment(this.exploreId),i=e.moment(this.exploreId).subtract(1,"day"),s=e.moment(this.exploreId).add(1,"day");return t={isJustifiedLayout:"justified"===this.photoListLayoutStyle,isStoryLayout:"story"===this.photoListLayoutStyle,godUser:this.appContext.getViewer().isInsecureGod,currDateStr:o.format("LL"),prevDateStr:i.format("LL"),prevDateLink:e.url({path:"/explore/"+i.format("YYYY/MM/DD"),host:!1}),nextDateStr:s.format("LL"),nextDateLink:e.url({path:"/explore/"+s.format("YYYY/MM/DD"),host:!1}),disableNext:s.isAfter(this.explorePhotosReadyForMoment)},this.setContainerWithTemplate("explore-page",t),this},activate:function(){var t=this.get("container"),o=t.one(".tool.tools-menu");return this.registerEventHandler(t.delegate("click",this.handleLayoutToggle.bind(this),".layout")),o&&this.registerEventHandler(o.on("click",this.handleToolsButtonClick.bind(this))),e.later(100,this,function(){e.use("photo-page-scrappy-view")}),this},onSubviewEvent:function(e,t){switch(t&&t.length&&t[0]){case"scotch:big":t[1]&&t[2]&&this.showBigScotchModal(t[1],t[2]);break;case"photoList:removePhoto":t[1]&&this.scotch(t[1])}},handleLayoutToggle:function(e){var t,o=this.get("container"),i=this.subviews["photo-list-view"],s=i.photoListLayout;e.preventDefault(),(t=e.target.getData("layout-style"))!==this.photoListLayoutStyle&&(o.one(".layout.selected").removeClass("selected"),e.target.addClass("selected"),this.photoListLayoutStyle=t,s.targetRowHeight="justified"===t?250:430,i.setItems(this.exploreModel.getValue("photos").getList()))},handleToolsButtonClick:function(t){var o,i=t.currentTarget;i.addClass("open"),(o=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorOffsetHorizontal:11,anchorElement:t.currentTarget,positionFixed:!1,preferBottom:!0,dismissOnOverlayClick:!0,multiSelect:!0,menuItems:this.toolsMenuItems})).show(),this.registerEventHandler(o.on("selected",function(e){e&&e.menuItem&&e.menuItem.callback&&e.menuItem.callback(e.menuItem.selected)})),this.registerEventHandler(o.on("closeDroparound",function(e){i.removeClass("open")}))},handleToggleToolsEntry:function(e){var t=this.subviews["photo-list-view"];t.subviewMapping={"photo-lite-models":{name:"photo-list-photo-view",params:{bigScotch:e,scotch:e}}},t.setItems(this.exploreModel.getValue("photos").getList())},scotch:function(e){var t,s,n=this.subviews["photo-list-view"].getSubview(e),r=this;if(n)return t=n.get("container").hasClass("scotched")?i.unscotch:i.scotch,s={photo_id:e},this.appContext.callAPI(t,s).then(function(){n.get("container").toggleClass("scotched")},function(t){r.displayErrorModal(r.godMessage({intlName:"explore.SCOTCHING_FAILED_MESSAGE"})),o.warn("error scotching",{err:t,photoId:e})})},showBigScotchModal:function(t,o){var i,s,n,r=this;(i=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!0,showCancelButton:!0,showCancelX:!1,title:this.godMessage({intlName:"explore.BIG_SCOTCH_MODAL_TITLE"}),actionButtonLabel:this.godMessage({intlName:"explore.BIG_SCOTCH_ACTION_BUTTON_TEXT"}),actionButtonIsDangerous:!0,actionButtonDisabled:!0,subview:new e.Views["explore-big-scotch-modal-view"]({appContext:this.appContext})})).show(),i.registerEventHandler(e.on("exploreBigScotch:justificationComplete",function(e){i.enableActionButton()})),i.registerEventHandler(e.on("exploreBigScotch:justificationIncomplete",function(e){i.disableActionButton()})),i.registerEventHandler(i.on("actionClick",function(e){s=i.get("subview").get("selectedExcludeReasonValue"),n=i.get("subview").get("excludeComment"),r.scotch(o),r.bigScotch(t,s,n)}))},bigScotch:function(e,t,s){var n,r=this;return n={user_id:e,comment:s||t},this.appContext.callAPI(i.bigScotch,n).then(function(){},function(t){r.displayErrorModal(r.godMessage({intlName:"explore.BIG_SCOTCH_FAILED_MESSAGE"})),o.warn("error excluding person",{err:t,nsid:e})})},displayErrorModal:function(t){new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.ERROR"}),message:t,actionButtonLabel:this.intlMessage({intlName:"common.OK"}),showCancelButton:!1}).show()}},{ATTRS:{spaceid:{value:792600541}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","explore-models","hermes-template-explore-page","footer-full-view","photo-list-view","fluid-modal-view","fluid-droparound-view","explore-big-scotch-modal-view","fluid-explore-subnav-view","signup-footer-view","hermes-template-head-meta","moment","url"],langBundles:["common"]});