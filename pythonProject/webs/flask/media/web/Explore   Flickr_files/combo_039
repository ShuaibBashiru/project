YUI.add("hermes-template-stuff-selection-view",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,a,l){return"large"},3:function(e,t,n,a,l){var r,s=null!=t?t:{},i=n.helperMissing,o=e.escapeExpression;return'\t\t\t<a class="create-button" href="'+o("function"==typeof(r=null!=(r=n.createUrl||(null!=t?t.createUrl:t))?r:i)?r.call(s,{name:"createUrl",hash:{},data:l}):r)+'" target="_blank" tabindex="0">\n\t\t\t\t<span class="create-button-text">'+o("function"==typeof(r=null!=(r=n.buttonTextCreateNew||(null!=t?t.buttonTextCreateNew:t))?r:i)?r.call(s,{name:"buttonTextCreateNew",hash:{},data:l}):r)+"</span>\n\t\t\t</a>\n"},5:function(e,t,n,a,l){var r;return'\t\t\t<button class="create-button unfluid" tabindex="0">\n\t\t\t\t<span class="create-button-text">'+e.escapeExpression("function"==typeof(r=null!=(r=n.buttonTextCreateNew||(null!=t?t.buttonTextCreateNew:t))?r:n.helperMissing)?r.call(null!=t?t:{},{name:"buttonTextCreateNew",hash:{},data:l}):r)+"</span>\n\t\t\t</button>\n"},7:function(e,t,n,a,l){var r;return'\t\t\t<button class="button mini done-button">'+e.escapeExpression("function"==typeof(r=null!=(r=n.doneText||(null!=t?t.doneText:t))?r:n.helperMissing)?r.call(null!=t?t:{},{name:"doneText",hash:{},data:l}):r)+"</button>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,a,l){var r,s,i=null!=t?t:{},o=n.helperMissing,u=e.escapeExpression;return'<div class="stuff-selection '+(null!=(r=n.if.call(i,null!=t?t.isLarge:t,{name:"if",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l}))?r:"")+'">\n\t<div class="stuff-selection-search-container">\n\t\t<input type="text" placeholder="'+u("function"==typeof(s=null!=(s=n.placeholderSearch||(null!=t?t.placeholderSearch:t))?s:o)?s.call(i,{name:"placeholderSearch",hash:{},data:l}):s)+'" class=\'stuff-selection-search\' tabindex="0" />\n\t</div>\n\t<div class="stuff-selection-list-container">\n\t\t<div class="loading-text">'+u("function"==typeof(s=null!=(s=n.loadingText||(null!=t?t.loadingText:t))?s:o)?s.call(i,{name:"loadingText",hash:{},data:l}):s)+'</div>\n\t</div>\n\t<div class="action-container">\n'+(null!=(r=(n.ifDefined||t&&t.ifDefined||o).call(i,null!=t?t.createUrl:t,{name:"ifDefined",hash:{},fn:e.program(3,l,0),inverse:e.program(5,l,0),data:l}))?r:"")+"\n"+(null!=(r=n.if.call(i,null!=t?t.isLarge:t,{name:"if",hash:{},fn:e.program(7,l,0),inverse:e.noop,data:l}))?r:"")+"\t</div>\n</div>\n"},useData:!0}),a={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(a[t]=n)}),e.Template.register("hermes/stuff-selection-view",function(t,l){return l=l||{},l.partials=l.partials?e.merge(a,l.partials):a,n(t,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-stuff-select-list-item",function(n,t){var e=n.Template.Handlebars.revive({1:function(n,t,e,a,l){return"has-photo"},3:function(n,t,e,a,l){return"is-pending"},5:function(n,t,e,a,l){return"is-invited"},7:function(n,t,e,a,l){var i;return'\t\t\t<img src="'+n.escapeExpression("function"==typeof(i=null!=(i=e.bestIconURL||(null!=t?t.bestIconURL:t))?i:e.helperMissing)?i.call(null!=t?t:{},{name:"bestIconURL",hash:{},data:l}):i)+'" class="item-icon" />\n'},9:function(n,t,e,a,l){return'\t\t\t<img src="https://combo.staticflickr.com/pw/images/buddyicon11_s.png" class="item-icon" />\n'},11:function(n,t,e,a,l){return"accept"},13:function(n,t,e,a,l){return"cancel"},compiler:[7,">= 4.0.0"],main:function(n,t,e,a,l){var i,s,r=null!=t?t:{},c=e.helperMissing,u=n.escapeExpression;return'\n<li class="selection-item '+(null!=(i=e.if.call(r,null!=t?t.hasPhoto:t,{name:"if",hash:{},fn:n.program(1,l,0),inverse:n.noop,data:l}))?i:"")+" "+(null!=(i=e.if.call(r,null!=t?t.isPending:t,{name:"if",hash:{},fn:n.program(3,l,0),inverse:n.noop,data:l}))?i:"")+" "+(null!=(i=e.if.call(r,null!=t?t.isInvited:t,{name:"if",hash:{},fn:n.program(5,l,0),inverse:n.noop,data:l}))?i:"")+'" data-curation-id="'+u("function"==typeof(s=null!=(s=e.curationId||(null!=t?t.curationId:t))?s:c)?s.call(r,{name:"curationId",hash:{},data:l}):s)+'" >\n\t<div class="selection-item-content">\n'+(null!=(i=e.if.call(r,null!=t?t.bestIconURL:t,{name:"if",hash:{},fn:n.program(7,l,0),inverse:n.program(9,l,0),data:l}))?i:"")+'\n\t\t<div class="item-labels">\n\t\t\t<div class="item-title">'+u("function"==typeof(s=null!=(s=e.title||(null!=t?t.title:t))?s:c)?s.call(r,{name:"title",hash:{},data:l}):s)+'</div>\n\t\t\t<div class="item-stats">\n\t\t\t\t'+u((e.renderTrustedMarkup||t&&t.renderTrustedMarkup||c).call(r,null!=t?t.statDisplay:t,{name:"renderTrustedMarkup",hash:{},data:l}))+'\n\t\t\t</div>\n\t\t</div>\n\n\t\t<span class="item-status '+(null!=(i=e.if.call(r,null!=t?t.has:t,{name:"if",hash:{},fn:n.program(11,l,0),inverse:n.noop,data:l}))?i:"")+" "+(null!=(i=e.if.call(r,null!=t?t.has:t,{name:"if",hash:{},fn:n.program(13,l,0),inverse:n.noop,data:l}))?i:"")+'"></span>\n\t</div>\n</li>\n'},useData:!0}),a={};n.Array.each([],function(t){var e=n.Template.get("hermes/"+t);e&&(a[t]=e)}),n.Template.register("hermes/stuff-select-list-item",function(t,l){return l=l||{},l.partials=l.partials?n.merge(a,l.partials):a,e(t,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-stuff-select-list",function(e,t){var a=e.Template.Handlebars.revive({1:function(e,t,a,r,s){return" hidden"},3:function(e,t,a,r,s){var l;return null!=(l=e.invokePartial(r["stuff-select-list-item"],t,{name:"stuff-select-list-item",data:s,indent:"\t\t",helpers:a,partials:r,decorators:e.decorators}))?l:""},compiler:[7,">= 4.0.0"],main:function(e,t,a,r,s){var l,n=null!=t?t:{};return"<ol class='stuff-selection-list"+(null!=(l=a.if.call(n,null!=t?t.isEmpty:t,{name:"if",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s}))?l:"")+"'>\n"+(null!=(l=a.each.call(n,null!=t?t.curationList:t,{name:"each",hash:{},fn:e.program(3,s,0),inverse:e.noop,data:s}))?l:"")+'</ol>\n<div  class="none-text'+(null!=(l=a.if.call(n,null!=t?t.isEmpty:t,{name:"if",hash:{},fn:e.noop,inverse:e.program(1,s,0),data:s}))?l:"")+'">'+e.escapeExpression((a.renderTrustedMarkup||t&&t.renderTrustedMarkup||a.helperMissing).call(n,null!=t?t.noneText:t,{name:"renderTrustedMarkup",hash:{},data:s}))+"</div>"},usePartial:!0,useData:!0}),r={};e.Array.each(["stuff-select-list-item"],function(t){var a=e.Template.get("hermes/"+t);a&&(r[t]=a)}),e.Template.register("hermes/stuff-select-list",function(t,s){return s=s||{},s.partials=s.partials?e.merge(r,s.partials):r,a(t,s)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-stuff-select-list-item"]});YUI.add("hermes-template-private-photo-group-add-warning",function(a,e){var t=a.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(a,e,t,n,s){var i=null!=e?e:{},l=t.helperMissing,r=a.escapeExpression;return'<div class="private-warning-container">\n\t<h1>'+r((t.intlMessage||e&&e.intlMessage||l).call(i,{name:"intlMessage",hash:{intlName:"common.WARNING"},data:s}))+"</h1>\n\t<p>\n\t\t"+r((t.intlMessage||e&&e.intlMessage||l).call(i,{name:"intlMessage",hash:{intlName:"add-to-stuff.GROUP_PRIVATE_PHOTO_WARNING"},data:s}))+'\n\t</p>\n\t<p>\n\t\t<a role="button" class="private-warning-accept" tabindex="0">'+r((t.intlMessage||e&&e.intlMessage||l).call(i,{name:"intlMessage",hash:{intlName:"add-to-stuff.CONFIRM_GROUP_PRIVATE_PHOTO_ADD"},data:s}))+'</a>\n\t</p>\n\n\t<input type="checkbox" id="private-warning-checkbox">\n\t<label for="private-warning-checkbox">\n\t\t<span>'+r((t.intlMessage||e&&e.intlMessage||l).call(i,{name:"intlMessage",hash:{intlName:"add-to-stuff.DONT_SHOW_MESSAGE_AGAIN"},data:s}))+"</span>\n\t</label>\n</div>\n"},useData:!0}),n={};a.Array.each([],function(e){var t=a.Template.get("hermes/"+e);t&&(n[e]=t)}),a.Template.register("hermes/private-photo-group-add-warning",function(e,s){return s=s||{},s.partials=s.partials?a.merge(n,s.partials):n,t(e,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("stuff-selection-view",function(t,e){var i=require("hermes-core/flog")(e);t.FlickrView.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.curationType=t.curationType,this.loadingText=t.loadingText||this.intlMessage({intlName:"common.LOADING_WITH_ELLIPSES"}),this.placeholderSearch=t.placeholderSearch||this.intlMessage({intlName:"common.SEARCH"}),this.buttonTextCreateNew=t.buttonTextCreateNew||this.intlMessage({intlName:"common.NEW"}),this.noneText=t.noneText||this.intlMessage({intlName:"common.NONE"}),this.emptySearchText=t.emptySearchText||this.intlMessage({intlName:"common.NONE"}),this.noMatchesText=t.noMatchesText||this.intlMessage({intlName:"add-to-stuff.NO_RESULTS"}),this.doneText=t.doneText||this.intlMessage({intlName:"common.DONE"}),this.photoId=t.photoId,this.photoIds=t.photoIds,this.previousSearchValue="",this},buildContainer:function(){return this.setContainerWithTemplate("stuff-selection-view",{buttonTextCreateNew:this.buttonTextCreateNew,loadingText:this.loadingText,placeholderSearch:this.placeholderSearch,isLarge:this.params.useLargeLayout,createUrl:this.params.createUrl,doneText:this.doneText}),this},activate:function(){var e,i=this.get("container"),s=i.one(".done-button");return this.hasSearchResults=!0,this.searchContainer=i.one(".stuff-selection-search-container"),this.searchBox=this.searchContainer.one(".stuff-selection-search"),this.curationListContainerNode=i.one(".stuff-selection-list-container"),this.createButton=i.one(".create-button"),this.createButton.setAttribute("disabled"),this.registerEventHandler(this.searchBox.on("focus",function(){this.searchContainer.addClass("focused")}.bind(this))),this.loadCurations().then(function(){e=this.templates("stuff-select-list")({curationList:this.curationList,isEmpty:0===this.curationList.length,noneText:this.noneText}),this.curationListContainerNode.removeClass("loading"),this.curationListContainerNode.setHTML(e),this.createButton.removeAttribute("disabled"),this.curationListNode=i.one(".stuff-selection-list"),this.noneTextNode=i.one(".none-text"),this.registerEventHandler(this.curationListContainerNode.delegate("click",this.handleCurationClick.bind(this),".selection-item")),this.registerEventHandler(i.delegate("keyup",this.handleSearch.bind(this),".stuff-selection-search")),this.registerEventHandler(i.one(".stuff-selection-search").on("blur",function(){this.searchContainer.removeClass("focused")}.bind(this))),s&&this.registerEventHandler(s.on("click",function(){this.signalClose()}.bind(this))),this.registerEventHandler(t.on("addToStuff:keyPressed",function(t){t&&t.curationType===this.curationType&&this.handleKeyPress(t.evt)}.bind(this))),this.curationType===this.params.initialTab&&this.searchBox.focus(),this.isPhotoOwner&&i.addClass("is-photo-owner"),this.showPrivateWarning&&this.displayPrivateWarning(),this.handleSearch()}.bind(this))},handleCurationClick:function(t){t.preventDefault();var e=t.currentTarget,i=e.getAttribute("data-curation-id"),s=this.getCurationById(i);this.toggleCuration(e,s)},toggleCuration:function(t,e){e.hasPhoto||!this.isPhotoOwner&&e.isInvited||this.isPhotoOwner&&e.isPending?this.handleRemoveFromCuration(t,e.id).then(function(){this.dismissOnSelect&&this.signalClose(300)}.bind(this)):this.handleAddToCuration(t,e.id,e.isPending).then(function(){this.dismissOnSelect&&this.signalClose(300)}.bind(this))},handleAddToCuration:function(e,s,n){return this.currentlyAdding||this.currentlyRemoving||this.isClosing?t.Promise.reject():(this.currentlyAdding=!0,e.addClass("waiting"),e.one(".item-status").append(this.templates("flickr-balls")({})),this.addPhoto(s,null,n).then(function(t){e.removeClass("waiting"),e.one(".balls").remove(),t&&(t.isPending||t.isInvited?t.isPending?e.addClass("is-pending"):t.isInvited&&e.addClass("is-invited"):(e.addClass("has-photo"),e.removeClass("is-pending"),e.removeClass("is-invited"),t.photoCountDisplay&&e.one(".item-stats").set("text",t.photoCountDisplay))),this.currentlyAdding=!1}.bind(this)).catch(function(t){throw i.error("Error adding photo to curation",{err:t}),e.removeClass("waiting"),e.one(".balls").remove(),this.currentlyAdding=!1,t}.bind(this)))},handleRemoveFromCuration:function(e,i){return this.currentlyAdding||this.currentlyRemoving||this.isClosing?t.Promise.reject():(this.currentlyRemoving=!0,e.addClass("waiting"),e.one(".item-status").append(this.templates("flickr-balls")({})),this.removePhoto(i).then(function(t){e.removeClass("waiting"),e.removeClass("has-photo"),e.removeClass("is-pending"),e.removeClass("is-invited"),e.one(".balls").remove(),t&&t.photoCountDisplay&&e.one(".item-stats").set("text",t.photoCountDisplay),this.currentlyRemoving=!1}.bind(this)))},getCurationById:function(t){for(var e=0;e<this.curationList.length;e++)if(t===this.curationList[e].curationId)return this.curationList[e];return null},addPhoto:function(e,i,s){return t.Promise.resolve()},removePhoto:function(e){return t.Promise.resolve()},loadCurations:function(){return t.Promise.resolve()},handleSearch:function(){var t=this,e=(this.get("container"),this.searchBox.get("value")),i=this.convertToSearchText(e),s=0;this.previousSearchValue!==e&&(0!==this.curationList.length?(this.curationList.forEach(function(e){var n=t.curationListNode.one('.selection-item[data-curation-id="'+e.curationId+'"]'),o=t.convertToSearchText(e.title);n&&(-1===o.indexOf(i)?n.toggleClass("hidden",!0):(n.toggleClass("hidden",!1),s++))}),0===s&&this.hasSearchResults&&(this.hasSearchResults=!1,this.toggleEmpty(!0,this.emptySearchText)),s>0&&!this.hasSearchResults&&(this.hasSearchResults=!0,this.toggleEmpty(!1)),this.previousSearchValue=e,this.focusedItem&&(this.focusedItem.removeClass("focused"),this.focusedItem=null)):this.toggleEmpty(!0,this.params.noneText))},convertToSearchText:function(e){return t.fluid.removeDiacritics(e).replace(/[\W,_]/g,"").toLowerCase()},toggleEmpty:function(t,e){this.curationListNode.toggleClass("hidden",t),this.noneTextNode.set("innerHTML",e||this.params.noneText),this.noneTextNode.toggleClass("hidden",!t)},handleKeyPress:function(t){var e,i,s,n,o=t.keyCode;38===o||40===o?(t.halt(),this.searchBox.focus(),i=this.curationListNode.all(".selection-item:not(.hidden)"),this.focusedItem&&this.focusedItem.removeClass("focused"),38===o?(e=i.indexOf(this.focusedItem)>0?i.indexOf(this.focusedItem)-1:i.size()-1,this.focusedItem=i.item(e),this.focusedItem&&(this.focusedItem.addClass("focused"),this.animateScrollToItem(this.curationListNode,this.focusedItem,.4))):40===o&&(e=(i.indexOf(this.focusedItem)+1)%i.size(),this.focusedItem=i.item(e),this.focusedItem&&(this.focusedItem.addClass("focused"),this.animateScrollToItem(this.curationListNode,this.focusedItem,.4)))):13===o?this.focusedItem&&(s=this.focusedItem.getAttribute("data-curation-id"),n=this.getCurationById(s),this.toggleCuration(this.focusedItem,n)):9===o&&this.focusedItem&&(this.focusedItem.removeClass("focused"),this.focusedItem=null)},animateScrollToItem:function(e,i,s){var n=e.getDOMNode().getBoundingClientRect(),o=i.getDOMNode().getBoundingClientRect(),a=0;o.top<n.top?(a=i.get("offsetTop"),t.use("anim",function(t){new t.Anim({duration:s,node:e,easing:"easeOutStrong",to:{scroll:[0,a]}}).run()})):o.bottom>n.bottom&&(a=i.get("offsetTop")-(n.height-o.height),t.use("anim",function(t){new t.Anim({duration:s,node:e,easing:"easeOutStrong",to:{scroll:[0,a]}}).run()}))},prepareCurationForList:function(t){},displayPrivateWarning:function(){},signalClose:function(t){var e=this;this.isClosing=!0,t?setTimeout(function(){e.fire("subviewViewEvent",{eventName:"readyToClose"})},t):e.fire("subviewViewEvent",{eventName:"readyToClose"})},renderCurationList:function(){var t=this;t.curationListNode.set("innerHTML",""),this.curationList.forEach(function(e){var i=t.templates("stuff-select-list-item")(e);t.curationListNode.append(i),t.toggleEmpty(!1)}),this.previousSearchValue="",t.handleSearch()},reload:function(){return this.loadCurations().then(function(){this.renderCurationList()}.bind(this))},focusInitial:function(){this.searchBox&&this.searchBox.focus()}})},"@VERSION@",{requires:["flickr-view","hermes-template-stuff-selection-view","hermes-template-flickr-balls","hermes-template-stuff-select-list","hermes-template-private-photo-group-add-warning"],optional:["set-models"],langBundles:["common","add-to-stuff"]});YUI.add("album-selection-view",function(t,e){var i=require("hermes-core/flog")(e);t.namespace("Views")[this.name]=t.Base.create("album-selection-view",t.Views["stuff-selection-view"],[],{langBundles:this.details.langBundles,initializer:function(t){return this.params=t,this.params.curationType="album",this.params.loadingText=t.loadingText||this.intlMessage({intlName:"more-menu-view.LOADING_ALBUMS"}),this.params.placeholderSearch=t.placeholderSearch||this.intlMessage({intlName:"photo-page-scrappy.SEARCH_ALBUMS"}),this.params.buttonTextCreateNew=t.buttonTextCreateNew||this.intlMessage({intlName:"add-to-stuff.CURATIONS_CREATE_NEW_ALBUM"}),this.params.noneText=t.noneText||this.intlMessage({intlName:"more-menu-view.NO_ALBUMS"}),this.params.emptySearchText=t.emptySearchText||this.params.noneText,this.dismissOnCreate=this.params.dismissOnCreate||this.params.dismissOnCreateAlbum,this.dismissOnSelect=this.params.dismissOnSelect||this.params.dismissOnSelectAlbum,this.inlineCreation=void 0===this.params.inlineAlbumCreation||this.params.inlineAlbumCreation,this.numberOfPhotosSelected=t.numberOfPhotosSelected||0,this.numberOfVideosSelected=t.numberOfVideosSelected||0,this.photosSelectedIds=t.photosSelectedIds||[],this.videosSelectedIds=t.videosSelectedIds||[],this.pageCount=1,this.perPage=500,this.constructor.superclass.initializer.call(this,t),this},activate:function(){var t=this;return this.constructor.superclass.activate.call(this).then(function(){t.registerEventHandler(t.createButton.on(["click","key"],function(){t.fire("showCreate",{type:t.curationType})},"down:13"))})},loadCurations:function(){return this.appContext.getModel("sets-models",{id:this.appContext.getViewer().nsid,page:this.pageCount,perPage:this.perPage}).then(function(t){if(this.albumsModel=t,this.albumsModel)return this.pageCount=Math.ceil(t.getValue("albumsList").size()/this.perPage),this.recursivelyLoadAlbums()}.bind(this)).then(function(){return this.setupCurationList(),this.findAndMarkPhotoAlbums()}.bind(this)).catch(function(t){throw i.error("Error fetching albums",{err:t}),t}.bind(this))},recursivelyLoadAlbums:function(){var t=this.albumsModel.getValue("totalItems");if(this.pageCount*this.perPage<t)return this.albumsModel.getValue("albumsList").getPage({page:++this.pageCount,perPage:this.perPage}).then(this.recursivelyLoadAlbums.bind(this)).catch(function(t){throw i.error("Error fetching albums",{err:t}),t}.bind(this))},setupCurationList:function(){var t=this.albumsModel.toJSON().albumsList;this.curationList=[],this.curationList=t.filter(function(t){return!t.isAutoUploadSet}),this.curationList.forEach(function(t,e){return this.prepareCurationForList(t),t}.bind(this))},sortAlbums:function(){var t=this,e=[];this.curationList=this.curationList.filter(function(t,i){return!t.hasPhoto||(e.unshift(t),!1)}),e.forEach(function(e){t.curationList.unshift(e)})},findAndMarkPhotoAlbums:function(){return this.photoIds?this.appContext.callAPI("flickr.cameraroll.getPhotosMeta",{photo_ids:this.photoIds.join(","),properties:"albums"},!0).then(function(t){t&&t.albums&&(t.albums.forEach(function(t,e){var i=this.getCurationById(t.id);i&&(i.hasPhoto=!0)}.bind(this)),this.sortAlbums())}.bind(this)):this.appContext.getModel("photo-sets-models",this.photoId).then(function(t){return t.getListPageByContinuation(500).then(function(){this.albumsContainingPhoto=t.getValue("sets").toJSON(),this.albumsContainingPhoto&&(this.albumsContainingPhoto.forEach(function(t,e){var i=this.getCurationById(t.id);i&&(i.hasPhoto=!0)}.bind(this)),this.sortAlbums())}.bind(this))}.bind(this)).catch(function(t){throw i.error("Error loading albums",{err:t}),t}.bind(this))},addPhoto:function(e,s){var o=this,n=s||this.photoIds,r=[],a=[];return this.appContext.getModelRegistry("set-models").then(function(i){if(n){for(var s=0;s<n.length;s+=500)r.push(n.slice(s,s+500<n.length?s+500:n.length));return r.forEach(function(t,s){a.push(i.remote.addPhoto({photoID:t.join(","),isMultiplePhotos:!0,photosSelectedIds:o.photosSelectedIds,videosSelectedIds:o.videosSelectedIds,numberOfPhotosSelected:o.params.numberOfPhotosSelected,numberOfVideosSelected:o.params.numberOfVideosSelected,setID:e,updateItemCounts:0===s},o.appContext))}),t.Promise.all(a).then(function(t){return t&&t[0]?t[0].setModel:null})}return i.remote.addPhoto({photoID:this.photoId,setID:e},this.appContext)}.bind(this)).then(function(t){var i=this.getCurationById(e);return i.hasPhoto=!0,i.photoCountDisplay=t.getValue("photoCountDisplay"),i}.bind(this)).catch(function(t){throw i.error("Error adding photo to album",{err:t}),t}.bind(this))},removePhoto:function(e){var s=this,o=this.photoIds,n=[],r=[];return this.appContext.getModelRegistry("set-models").then(function(i){if(this.photoIds){for(var a=0;a<o.length;a+=500)n.push(o.slice(a,a+500<o.length?a+500:o.length));return n.forEach(function(t,o){r.push(i.remote.removePhoto({photoID:t.join(","),isMultiplePhotos:!0,numberOfPhotosSelected:s.params.numberOfPhotosSelected,numberOfVideosSelected:s.params.numberOfVideosSelected,updateItemCounts:0===o,setID:e},s.appContext))}),t.Promise.all(r).then(function(t){return t?t[0]:null})}return i.remote.removePhoto({photoID:this.photoId,setID:e},this.appContext)}.bind(this)).then(function(t){var i=this.getCurationById(e);return t?(i.hasPhoto=!1,i.photoCountDisplay=t.getValue("photoCountDisplay")):(this.get("container").one('.stuff-selection-list li[data-curation-id="'+e+'"]').remove(),this.curationList=this.curationList.filter(function(t){return t.id!==e}),this.handleSearch()),i}.bind(this)).catch(null,function(t){throw i.error("Error removing photo from album",{err:t}),t}.bind(this))},prepareCurationForList:function(t){t.curationId=t.id,t.statDisplay=t.photoCountDisplay}})},"@VERSION@",{requires:["flickr-view","flickr-promise","stuff-selection-view"],langBundles:["more-menu-view","photo-page-scrappy","common","add-to-stuff"]});YUI.add("gallery-selection-view",function(t,e){var i=require("hermes-core/flog")(e);t.namespace("Views")[this.name]=t.Base.create("gallery-selection-view",t.Views["stuff-selection-view"],[],{langBundles:this.details.langBundles,initializer:function(t){return this.params=t,this.params.curationType="gallery",this.params.loadingText=t.loadingText||this.intlMessage({intlName:"more-menu-view.LOADING_GALLERIES"}),this.params.placeholderSearch=t.placeholderSearch||this.intlMessage({intlName:"photo-page-scrappy.SEARCH_GALLERIES"}),this.params.buttonTextCreateNew=t.buttonTextCreateNew||this.intlMessage({intlName:"add-to-stuff.CURATIONS_CREATE_NEW_GALLERY"}),this.params.noneText=t.noneText||this.intlMessage({intlName:"more-menu-view.NO_GALLERIES"}),this.params.emptySearchText=t.emptySearchText||this.params.noneText,this.dismissOnCreate=this.params.dismissOnCreate||this.params.dismissOnCreateGallery,this.dismissOnSelect=this.params.dismissOnSelect||this.params.dismissOnSelectGallery,this.inlineCreation=void 0===this.params.inlineGalleryCreation||this.params.inlineGalleryCreation,this.constructor.superclass.initializer.call(this,t),this},activate:function(){var t=this;return this.constructor.superclass.activate.call(this).then(function(){t.registerEventHandler(t.createButton.on(["click","key"],function(){t.fire("showCreate",{type:t.curationType})},"down:13"))})},loadCurations:function(){var e=[];return e.push(this.appContext.getModel("photo-models",this.photoId).then(function(t){this.photoModel=t}.bind(this))),e.push(this.appContext.getModelRegistry("smart-galleries-models").then(function(t){t.remove(this.appContext.auth.user.nsid)}.bind(this))),t.Promise.all(e).then(function(){return this.appContext.getModel("smart-galleries-models",{id:this.appContext.auth.user.nsid,continuation:0,photoIds:[this.photoId],sortGroups:["has_photo"]})}.bind(this)).then(function(t){return this.galleriesModel=t,this.appContext.getModelRegistry("gallery-photo-association-models")}.bind(this)).then(function(t){return this.galleryPhotoAssociationRegistry=t,this.recursivelyLoadRemainingGalleries(this.galleriesModel.getValue("continuation"))}.bind(this)).then(function(){this.curationList=[],this.galleriesModel&&this.setupCurationList()}.bind(this)).catch(function(t){throw i.error("Error loading galleries",{err:t}),t}.bind(this))},recursivelyLoadRemainingGalleries:function(){var e=this;return this.galleriesModel.getValue("galleries").getList().length<this.galleriesModel.getValue("galleries").totalItems&&"-1"!==this.galleriesModel.getValue("continuation")?this.galleriesModel.readNextGalleriesRemote().then(function(){return e.recursivelyLoadRemainingGalleries()}):t.Promise.resolve()},setupCurationList:function(){this.curationList=this.galleriesModel.getValue("galleries").toJSON(),this.curationList.forEach(function(t,e){return this.prepareCurationForList(t),this.galleryPhotoAssociationRegistry.exists(t.id+"-"+this.photoId)&&(t.hasPhoto=!0),t}.bind(this))},addPhoto:function(e){return this.appContext.getModelRegistry("gallery-models").then(function(t){return t.remote.addPhoto({photoID:this.photoId,galleryID:e},this.appContext)}.bind(this)).then(function(i){var s;return i.apiResponse.failures?t.Promise.reject(i.apiResponse.failures[0]):(s=this.getCurationById(e),s.hasPhoto=!0,s.photoCountDisplay=i.galleryModel.getValue("photoCountDisplay"),this.updateStatDisplay(e,s.photoCountDisplay),s)}.bind(this)).catch(function(s){var a=this.photoModel.getValue("mediaType");switch(s.code){case 6:this.updateStatDisplay(e,t.StringHelper.preventOrphans(this.intlMessage({intlName:"add-to-stuff.ONLY_PUBLIC_PHOTOS_ALLOWED",mediaType:a})),!0);break;case 10:this.updateStatDisplay(e,t.StringHelper.preventOrphans(this.intlMessage({intlName:"add-to-stuff.GALLERY_FULL"})),!0);break;case 11:this.updateStatDisplay(e,t.StringHelper.preventOrphans(this.intlMessage({intlName:"add-to-stuff.ONLY_SAFE_PHOTOS_ALLOWED",mediaType:a})),!0);break;case 12:this.updateStatDisplay(e,t.StringHelper.preventOrphans(this.intlMessage({intlName:"add-to-stuff.YOUVE_BEEN_BLOCKED"})),!0);break;case 13:this.updateStatDisplay(e,t.StringHelper.preventOrphans(this.intlMessage({intlName:"add-to-stuff.OWNER_DOESNT_ALLOW_IN_GALLERIES",mediaType:a})),!0);break;default:this.updateStatDisplay(e,t.StringHelper.preventOrphans(this.intlMessage({intlName:"add-to-stuff.COULDNT_ADD_PHOTO",mediaType:a})),!0)}throw i.error("Error adding photo to gallery",{err:s}),s}.bind(this))},removePhoto:function(t){return this.appContext.getModelRegistry("gallery-models").then(function(e){return e.remote.removePhoto({photoID:this.photoId,galleryID:t},this.appContext)}.bind(this)).then(function(e){var i=this.getCurationById(t);return i.hasPhoto=!1,i.photoCountDisplay=e.getValue("photoCountDisplay"),i}.bind(this)).catch(function(t){throw i.error("Error removing photo from gallery",{err:t}),t}.bind(this))},prepareCurationForList:function(t){t.curationId=t.id,t.statDisplay=t.photoCountDisplay},updateStatDisplay:function(t,e,i){var s=this.get("container").one('.stuff-selection-list li[data-curation-id="'+t+'"]').one(".item-stats");s&&(i?s.addClass("error-message"):s.removeClass("error-message"),s.setHTML(e))}})},"@VERSION@",{requires:["flickr-view","flickr-promise","stuff-selection-view"],langBundles:["more-menu-view","photo-page-scrappy","common","add-to-stuff","gallery"]});